{% extends 'vocab/base.html' %}

{% block title %}Browse Kikuyu Words{% endblock %}

{% block content %}
<div class="hero-section">
    <div class="container">
        <h1 class="hero-title">Kikuyu Vocabulary</h1>
        <p class="hero-subtitle">Discover and learn {{ total_words }} Kikuyu words with audio pronunciations</p>
    </div>
</div>

<div class="container">
    <!-- Search & Filter Section -->
    <div class="search-filter-section">
        <!-- Search Bar -->
        <form method="GET" action="{% url 'vocab-list' %}" class="search-form">
            <div class="search-input-group">
                <input
                    type="text"
                    name="q"
                    placeholder="Search by Kikuyu word or English translation..."
                    value="{{ search_query }}"
                    class="search-input"
                    autofocus
                >
                <button type="submit" class="search-btn">
                    üîç Search
                </button>
            </div>
        </form>

        <!-- Filters -->
        <div class="filters">
            <form method="GET" action="{% url 'vocab-list' %}" class="filter-form">
                <!-- Preserve search query -->
                {% if search_query %}
                    <input type="hidden" name="q" value="{{ search_query }}">
                {% endif %}

                <!-- Category Filter -->
                <select name="category" class="filter-select" onchange="this.form.submit()">
                    <option value="">All Categories</option>
                    {% for cat in categories %}
                        <option value="{{ cat.slug }}" {% if active_category == cat.slug %}selected{% endif %}>
                            {{ cat.icon }} {{ cat.name }} ({{ cat.word_count }})
                        </option>
                    {% endfor %}
                </select>

                <!-- Difficulty Filter -->
                <select name="difficulty" class="filter-select" onchange="this.form.submit()">
                    <option value="">All Levels</option>
                    <option value="beginner" {% if active_difficulty == 'beginner' %}selected{% endif %}>Beginner</option>
                    <option value="intermediate" {% if active_difficulty == 'intermediate' %}selected{% endif %}>Intermediate</option>
                    <option value="advanced" {% if active_difficulty == 'advanced' %}selected{% endif %}>Advanced</option>
                </select>

                <!-- Sort Options -->
                <select name="sort" class="filter-select" onchange="this.form.submit()">
                    <option value="-created_at" {% if active_sort == '-created_at' %}selected{% endif %}>Newest First</option>
                    <option value="oldest" {% if active_sort == 'oldest' %}selected{% endif %}>Oldest First</option>
                    <option value="alphabetical" {% if active_sort == 'alphabetical' %}selected{% endif %}>Alphabetical</option>
                    <option value="popular" {% if active_sort == 'popular' %}selected{% endif %}>Most Popular</option>
                </select>

                <!-- Clear Filters -->
                {% if search_query or active_category or active_difficulty or active_sort != '-created_at' %}
                    <a href="{% url 'vocab-list' %}" class="clear-filters">Clear Filters</a>
                {% endif %}
            </form>
        </div>

        <!-- Active Filters Display -->
        {% if search_query or active_category or active_difficulty %}
            <div class="active-filters">
                <span class="filter-label">Filters:</span>
                {% if search_query %}
                    <span class="filter-tag">Search: "{{ search_query }}"</span>
                {% endif %}
                {% if active_category %}
                    <span class="filter-tag">Category: {{ active_category }}</span>
                {% endif %}
                {% if active_difficulty %}
                    <span class="filter-tag">Level: {{ active_difficulty|title }}</span>
                {% endif %}
            </div>
        {% endif %}
    </div>

    <!-- Results Count -->
    <div class="results-info">
        <p>Showing <strong>{{ page_obj.paginator.count }}</strong> word{{ page_obj.paginator.count|pluralize }}</p>
    </div>

    <!-- Vocabulary Grid -->
    {% if vocabs %}
        <div class="vocab-grid">
            {% for vocab in vocabs %}
                <div class="vocab-card">
                    <a href="{% url 'vocab-detail' vocab.pk %}" class="vocab-card-link">
                        <!-- Image or Placeholder -->
                        <div class="vocab-card-image">
                            {% if vocab.image %}
                                <img src="{{ vocab.image.url }}" alt="{{ vocab.word }}">
                            {% else %}
                                <div class="vocab-card-placeholder">
                                    <span class="placeholder-icon">üìù</span>
                                </div>
                            {% endif %}

                            <!-- Badges -->
                            <div class="vocab-card-badges">
                                <span class="badge badge-category">{{ vocab.category.icon }} {{ vocab.category.name }}</span>
                                <span class="badge badge-difficulty badge-{{ vocab.difficulty }}">{{ vocab.difficulty }}</span>
                            </div>
                        </div>

                        <!-- Content -->
                        <div class="vocab-card-content">
                            <h3 class="vocab-word">{{ vocab.word }}</h3>
                            <p class="vocab-translation">{{ vocab.translation }}</p>

                            {% if vocab.pronunciation_guide %}
                                <p class="vocab-pronunciation">üó£Ô∏è {{ vocab.pronunciation_guide }}</p>
                            {% endif %}

                            <!-- Metadata -->
                            <div class="vocab-card-meta">
                                {% if vocab.audio %}
                                    <span class="meta-icon" title="Has audio">üéµ</span>
                                {% endif %}
                                <span class="meta-text">üëÅÔ∏è {{ vocab.view_count }}</span>
                                <span class="meta-text">‚ù§Ô∏è {{ vocab.favorite_count }}</span>
                            </div>

                            <!-- Tags -->
                            {% if vocab.tags.all %}
                                <div class="vocab-tags">
                                    {% for tag in vocab.tags.all|slice:":3" %}
                                        <span class="tag">{{ tag.name }}</span>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </a>
                </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if page_obj.has_other_pages %}
            <div class="pagination">
                {% if page_obj.has_previous %}
                    <a href="?page=1{% if search_query %}&q={{ search_query }}{% endif %}{% if active_category %}&category={{ active_category }}{% endif %}{% if active_difficulty %}&difficulty={{ active_difficulty }}{% endif %}{% if active_sort %}&sort={{ active_sort }}{% endif %}" class="page-link">
                        ¬´ First
                    </a>
                    <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if active_category %}&category={{ active_category }}{% endif %}{% if active_difficulty %}&difficulty={{ active_difficulty }}{% endif %}{% if active_sort %}&sort={{ active_sort }}{% endif %}" class="page-link">
                        ‚Äπ Previous
                    </a>
                {% endif %}

                <span class="page-current">
                    Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
                </span>

                {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if active_category %}&category={{ active_category }}{% endif %}{% if active_difficulty %}&difficulty={{ active_difficulty }}{% endif %}{% if active_sort %}&sort={{ active_sort }}{% endif %}" class="page-link">
                        Next ‚Ä∫
                    </a>
                    <a href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&q={{ search_query }}{% endif %}{% if active_category %}&category={{ active_category }}{% endif %}{% if active_difficulty %}&difficulty={{ active_difficulty }}{% endif %}{% if active_sort %}&sort={{ active_sort }}{% endif %}" class="page-link">
                        Last ¬ª
                    </a>
                {% endif %}
            </div>
        {% endif %}

    {% else %}
        <!-- Empty State -->
        <div class="empty-state">
            <div class="empty-icon">üîç</div>
            <h2>No words found</h2>
            <p>Try adjusting your search or filters</p>
            {% if user.is_authenticated %}
                <a href="{% url 'vocab-create' %}" class="btn btn-primary">Be the first to add a word!</a>
            {% endif %}
        </div>
    {% endif %}
</div>
{% endblock %}
